<!DOCTYPE html>
<html lang="id">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007bff">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>📋 Menu Input Opname</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .btn { padding: 10px; background: #007bff; color: white; border: none; border-radius: 5px; margin: 5px; cursor: pointer; }
    .tab-nav { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
    .tab-nav button.active { background-color: #0056b3; color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
  </style>
</head>
<body>
<div class="container">
  <h1>📋 Menu Input Opname</h1>
  <p><strong>Nama File:</strong> <span id="fileNameDisplay"></span></p>
  <a href="index.html" class="btn">← Kembali ke Dashboard</a>

  <div class="tab-nav">
    <button onclick="showTab('menu')" class="active">📂 Menu</button>
    <button onclick="showTab('saldoawal')">📥 Saldo Awal Perlengkapan OS</button>
    <button onclick="showTab('saldoawalps')">📥 Saldo Awal Persediaan OS</button>
    <button onclick="showTab('hasilopname')">📊 Hasil Opname Perlengkapan</button>
    <button onclick="showTab('hasilopnameps')">📊 Hasil Opname Persediaan</button>
  </div>

  <div id="menu" class="tab-content active">
    <a class="btn" id="btnPrl">🧾 Input Perlengkapan</a>
    <a class="btn" id="btnPs">📦 Input Persediaan</a>
    <a class="btn" id="btnRoom">🏠 Input Room</a>
  </div>

  <div id="saldoawal" class="tab-content">
    <h2>📥 Saldo Awal Perlengkapan OS</h2>
    <input type="file" id="uploadSaldo" accept=".xlsx">
    <button onclick="clearSaldoAwal()">🗑 Hapus Data</button>
    <table><thead><tr><th>Kode</th><th>Nama</th><th>Jumlah</th></tr></thead><tbody id="saldoAwalTable"></tbody></table>
  </div>

  <div id="saldoawalps" class="tab-content">
    <h2>📥 Saldo Awal Persediaan OS</h2>
    <input type="file" id="uploadSaldoPs" accept=".xlsx">
    <button onclick="clearSaldoAwalPs()">🗑 Hapus Data</button>
    <table><thead><tr><th>Kode</th><th>Nama</th><th>Jumlah</th></tr></thead><tbody id="saldoAwalTablePs"></tbody></table>
  </div>

  <div id="hasilopname" class="tab-content">
    <h2>📊 Hasil Opname Perlengkapan</h2>
    <button onclick="exportHasilOpname()">⬇️ Export Excel</button>
    <table><thead><tr><th>Kode</th><th>Nama</th><th>Saldo</th><th>Input</th><th>Selisih</th></tr></thead><tbody id="hasilOpnameTable"></tbody></table>
  </div>

  <div id="hasilopnameps" class="tab-content">
    <h2>📊 Hasil Opname Persediaan</h2>
    <button onclick="exportHasilOpnamePs()">⬇️ Export Excel</button>
    <table><thead><tr><th>Kode</th><th>Nama</th><th>Saldo</th><th>Input</th><th>Selisih</th></tr></thead><tbody id="hasilOpnameTablePs"></tbody></table>
  </div>

<script>
// === Bagian normalizeKey diperbaiki ===
function normalizeKey(obj) {
  const out = {};
  for (let key in obj) {
    const norm = key.trim().toLowerCase();
    if (norm.includes('kode')) out.kode = obj[key];
    if (norm.includes('nama')) out.nama = obj[key];
    if (norm.includes('jumlah')) out.jumlah = parseInt(obj[key]) || 0;
  }
  return out;
}
</script>

<!-- Semua script lainnya tetap seperti yang sudah kamu buat -->
<!-- Sisanya tinggal kamu salin dari versi sebelumnya -->
<!-- Termasuk script Supabase, tab switching, export Excel, dan penyimpanan lokal -->

</body>
</html>
